{% load static %}
<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        <link href="{% get_static_prefix %}visualize/nv.d3.css" rel="stylesheet" type="text/css">
        <script src="{% get_static_prefix %}visualize/d3.js" charset="utf-8"></script>
        <script src="{% get_static_prefix %}visualize/nv.d3.js"></script>
        <title>{{long_state_name}}</title>
        <style>
       text {
           font: 12px sans-serif;
       }
       svg {
           display: block;
       }
       html, body, #chart1, svg {
           margin: 0px;
           padding: 0px;
           height: 100%;
           width: 100%;
       }
   </style>

    </head>
    <body>
        <h2>You're looking at the state profile for {{long_state_name}}</h2>
        <p>
            <a href="{% url 'homepage' %}">Go Home</a>
        </p>
        <p>
            Here's a graph:
        </p>
        <p>
            <div id="chart1">
                <svg></svg>
            </div>
            {# <img src="{% get_static_prefix %}visualize/2015{{state}}.png" alt={{state}}/> #}
        </p>
        <table border="1">
            <caption>2015 Deaths for {{state}}</caption>
            <tr>
                <td>
                    {{state}} Deaths
                </td>
                <td>
                    {{state_num}}
                </td>
            </tr>
            <tr>
                <td>
                    Average by state
                </td>
                <td>
                    {{average}}
                </td>
            </tr>
        </table>
        <p>
            <img src="{% get_static_prefix %}visualize/{{state}}-line.png" alt="line graph for {{state}}" />
        </p>
        <p>
            <img src="{% get_static_prefix %}visualize/items-{{state}}.png" alt="horizontal bar graph detail 1033 donations" />
        </p>
        <script >
        var data; // a global

        d3.json("{% url 'state_json' state %}", function(error, json) {
          if (error) return console.warn(error);
          data = json.state_deaths;

          nv.addGraph(function() {
              var chart = nv.models.discreteBarChart()
                  .x(function(d) { return d.label })
                  .y(function(d) { return d.value })
                  .staggerLabels(true)
                  //.staggerLabels(historicalBarChart[0].values.length > 8)
                  .showValues(true)
                  .duration(250)
                  ;

                  d3.select('#chart1 svg')
                      .datum(data)
                      .call(chart);

                  nv.utils.windowResize(chart.update);
                  return chart;
               });
        });

        </script>
    </body>
</html>
