
{% extends 'visualize/base.html' %}
{% load static %}
<link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/u/bs-3.3.6/jqc-1.12.3,dt-1.10.12/datatables.min.css"/>

<script type="text/javascript" src="https://cdn.datatables.net/u/bs-3.3.6/jqc-1.12.3,dt-1.10.12/datatables.min.js"></script>

{% block content %}










<div class="container-fluid-full">

<div id="content" class="span10">


<ul class="breadcrumb">
  <li>
    <i class="icon-home"></i>
    <a href= {% url 'homepage' %}>Home</a>
    <i class="icon-angle-right"></i>
  </li>
  <li><a href="#">{{state}}</a></li>
</ul>

<div class="row-fluid">

  <div class="span3 statbox purple" onTablet="span6" onDesktop="span3">
    <div><h1>1033 Total</h1></div>
    <div><h1>{{ ten_thirty_three_total }}</h1></div>
  </div>
  <div class="span3 statbox green" onTablet="span6" onDesktop="span3">
    <div><h1>2015 Killings</h1></div>
    <div><h1>{{ state_num }}</h1></div>
  </div>
  <div class="span3 statbox blue noMargin" onTablet="span6" onDesktop="span3">
    <div><h1>State Population</h1></div>
    <div><h1>{{ twenty_fifteen_population }}</h1></div>
  </div>
  <div class="span3 statbox yellow" onTablet="span6" onDesktop="span3">
    <div><h1>Violent Crime</h1></div>
    <div><h1>{{ twenty_fourteen_violent }}</h1></div>
    <div><h1>Property Crime</h1></div>
    <div><h1>{{ twenty_fourteen_property }}</h1></div>
  </div>

</div>

<div class="row-fluid">

  <div id="stats-chart-2"  class="span8 widget green" onTablet="span8" onDesktop="span8">
    <div id="chart2"  style="height:282px" >  </div>
  </div>
  <div id="stats-chart-2"  class="span4 widget purple" onTablet="span8" onDesktop="span8">
      <div id="chart1"  style="height:282px">
      <svg></svg>
    </div>
    </div>
</div>

  <div class="row-fluid">

  	<div id="stats-chart-2"  class="span8 widget orange" onTablet="span8" onDesktop="span8">

    <h2><span class="glyphicons globe"><i></i></span> Demographics</h2>

    <hr>

    <div class="content">

      <p>
          <div id="chart3" style="height:282px">
              <svg></svg>
          </div>

      </div>

    </div>
    </div>


    <div class="row-fluid sortable">
    				<div class="box span12">
    					<div class="box-header" data-original-title>
    						<h2><i class="halflings-icon white user"></i><span class="break"></span>Counties</h2>
    						<div class="box-icon">
    							<a href="#" class="btn-setting"><i class="halflings-icon white wrench"></i></a>
    							<a href="#" class="btn-minimize"><i class="halflings-icon white chevron-up"></i></a>
    							<a href="#" class="btn-close"><i class="halflings-icon white remove"></i></a>
    						</div>
    					</div>
    					<div class="box-content">
    						<table class="table table-striped table-bordered bootstrap-datatable datatable">
    						  <thead>
    							  <tr>
    								  <th>County</th>
    								  <th>Date registered</th>
    								  <th>Role</th>
    								  <th>Status</th>
    								  <th>Actions</th>
    							  </tr>
    						  </thead>
    						  <tbody>
                    {% for county in counties_list %}
    							<tr>
    								<td class="center"><a href='/../county/{{county.id}}' >{{county}}</a></td>
    								<td class="center">2012/01/01</td>
    								<td class="center">Member</td>
    								<td class="center">
    									<span class="label label-success">Active</span>
    								</td>
    								<td class="center">
    									<a class="btn btn-success" href="#">
    										<i class="halflings-icon white zoom-in"></i>
    									</a>
    									<a class="btn btn-info" href="#">
    										<i class="halflings-icon white edit"></i>
    									</a>
    									<a class="btn btn-danger" href="#">
    										<i class="halflings-icon white trash"></i>
    									</a>
                      {% endfor %}
    								</td>

    							</tr>
                </div>
              </div>
            </div>
          </div>
  </div>

</div>




  <p>
      <div id="chart1">
          <svg></svg>
      </div>
      {# <img src="{% get_static_prefix %}visualize/2015{{state}}.png" alt={{state}}/> #}
  </p>
  <table border="1">
      <caption>2015 Deaths for {{state}}</caption>
      <tr>
          <td>
              {{state}} Deaths
          </td>
          <td>
              {{state_num}}
          </td>
      </tr>
      <tr>
          <td>
              Average by state
          </td>
          <td>
              {{average}}
          </td>
      </tr>
  </table>
  <p>
      <div id="chart2">
          <svg></svg>
      </div>
      {#<img src="{% get_static_prefix %}visualize/{{state}}-line.png" alt="line graph for {{state}}" />#}
  </p>
  <p>
      <div id="chart3">
          <svg></svg>
      </div>
      {#<img src="{% get_static_prefix %}visualize/items-{{state}}.png" alt="horizontal bar graph detail 1033 donations" />#}
  </p>
  <div id="chart4">
      <svg></svg>
  </div>
  <div id="chart5">
      <svg></svg>
  </div>
  <div id="chart6">
      <svg></svg>
  </div>
  <script >
  var data; // a global
  var categories = ["ATV", "Aircraft", "Assault/Tactical Vehicle", "Assualt Rifle", "Boat", "Bomb-Disposal Robot", "Helicopter", "Machete/Bayonnet/Knife", "Mine Resistant Vehicle", "Pistol", "Shotgun"]
  var categoryNums = Array.apply(null, Array(categories.length)).map(function (_, i) {return i;});
  d3.json("{% url 'state_json' state %}", function(error, json) {
    if (error) return console.warn(error);
    data = json;

    nv.addGraph(function() {
        var chart = nv.models.discreteBarChart()
            .x(function(d) { return d.label })
            .y(function(d) { return d.value })
            .staggerLabels(true)
            //.staggerLabels(historicalBarChart[0].values.length > 8)
            .showValues(true)
            .duration(250)
            ;

            d3.select('#chart1 svg')
                .datum(data.state_deaths)
                .call(chart);

            nv.utils.windowResize(chart.update);
            return chart;
         });
         nv.addGraph(function() {
        chart = nv.models.lineChart()
            .options({
                transitionDuration: 300,
                useInteractiveGuideline: true
            })
        ;
        // chart sub-models (ie. xAxis, yAxis, etc) when accessed directly, return themselves, not the parent chart, so need to chain separately
        chart.xAxis
            .axisLabel("Months")
            .tickFormat(function (d){
                  return d3.time.format('%B %Y')(new Date(d))
            })
            .staggerLabels(true)
        ;
        chart.yAxis
            .axisLabel('Deaths')
            .tickFormat(function(d) {
                if (d == null) {
                    return 'N/A';
                }
                return d3.format(',.2f')(d);
            })
        ;

        d3.select('#chart2').append('svg')
            .datum(data.deaths_over_time)
            .call(chart);
        nv.utils.windowResize(chart.update);
        return chart;
    });
    nv.addGraph(function() {
  chart = nv.models.multiBarChart()
      .barColor(d3.scale.category20().range())
      .duration(300)
      .margin({bottom: 100, left: 70})
      .rotateLabels(45)
      .groupSpacing(0.1)
  ;
  chart.reduceXTicks(false).staggerLabels(true);
  chart.xAxis
      .axisLabel("Categories")
      .axisLabelDistance(35)
      .showMaxMin(false)
      .tickValues(categoryNums)
      .tickFormat(function (d){
          console.log(data.category_data[0].values[d].label)
          return data.category_data[0].values[d].label;
      })
  ;
  chart.yAxis
      .axisLabel("Number of Items")
      .axisLabelDistance(-5)
      .tickFormat(d3.format(',.01f'))
  ;
  chart.dispatch.on('renderEnd', function(){
      nv.log('Render Complete');
  });
  d3.select('#chart3 svg')
      .datum(data.category_data)
      .call(chart);
  nv.utils.windowResize(chart.update);
  chart.dispatch.on('stateChange', function(e) {
      nv.log('New State:', JSON.stringify(e));
  });
  chart.state.dispatch.on('change', function(state){
      nv.log('state', JSON.stringify(state));
  });
  });
      nv.addGraph(function() {
     chart = nv.models.lineChart()
         .options({
             transitionDuration: 300,
             useInteractiveGuideline: true
         })
     ;
     // chart sub-models (ie. xAxis, yAxis, etc) when accessed directly, return themselves, not the parent chart, so need to chain separately
     chart.xAxis
         .axisLabel("Years")
         .tickFormat(function (d){
             console.log(data.dollars_by_year[0].values[d].label)
             return data.dollars_by_year[0].values[d].label;
         })
         .staggerLabels(true)
     ;
     chart.yAxis
         .axisLabel('$ Value Donated')
         .tickFormat(function(d) {
             if (d == null) {
                 return 'N/A';
             }
             return d3.format(',.2f')(d);
         })
     ;

     d3.select('#chart4').append('svg')
         .datum(data.dollars_by_year)
         .call(chart);
     nv.utils.windowResize(chart.update);
     return chart;
    });
    nv.addGraph(function() {
  chart = nv.models.multiBarChart()
      .barColor(d3.scale.category20().range())
      .duration(300)
      .margin({bottom: 100, left: 70})
      .rotateLabels(45)
      .groupSpacing(0.1)
  ;
  chart.reduceXTicks(false).staggerLabels(true);
  chart.xAxis
      .axisLabel("Categories")
      .axisLabelDistance(35)
      .showMaxMin(false)
      .tickValues(categoryNums)
      .tickFormat(function (d){
          console.log(data.categories_per_capita[0].values[d].label)
          return data.categories_per_capita[0].values[d].label;
      })
  ;
  chart.yAxis
      .axisLabel("Per Capita Number of Items")
      .axisLabelDistance(-5)
      .tickFormat(d3.format(',.01e'))
  ;
  chart.dispatch.on('renderEnd', function(){
      nv.log('Render Complete');
  });
  d3.select('#chart5 svg')
      .datum(data.categories_per_capita)
      .call(chart);
  nv.utils.windowResize(chart.update);
  chart.dispatch.on('stateChange', function(e) {
      nv.log('New State:', JSON.stringify(e));
  });
  chart.state.dispatch.on('change', function(state){
      nv.log('state', JSON.stringify(state));
  });
  });
  nv.addGraph(function() {
  chart = nv.models.multiBarChart()
      .barColor(d3.scale.category20().range())
      .duration(300)
      .margin({bottom: 100, left: 70})
      .rotateLabels(45)
      .groupSpacing(0.1)
  ;
  chart.reduceXTicks(false).staggerLabels(true);
  chart.xAxis
      .axisLabel("Crime Categories")
      .axisLabelDistance(35)
      .showMaxMin(false)
      .tickFormat(function (d){
          console.log(data.state_crime[0].values[d].label)
          return data.state_crime[0].values[d].label;
      })
  ;
  chart.yAxis
      .axisLabel("# of Crimes")
      .axisLabelDistance(-5)
      .tickFormat(d3.format(',f'))
  ;
  chart.dispatch.on('renderEnd', function(){
      nv.log('Render Complete');
  });
  d3.select('#chart6 svg')
      .datum(data.state_crime)
      .call(chart);
  nv.utils.windowResize(chart.update);
  chart.dispatch.on('stateChange', function(e) {
      nv.log('New State:', JSON.stringify(e));
  });
  chart.state.dispatch.on('change', function(state){
      nv.log('state', JSON.stringify(state));
  });
  });
  });

  </script>



{% endblock %}
